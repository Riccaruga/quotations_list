{% extends 'base/main.html' %}

{% block content %}

<div class="form-header">
    <a href="{% url 'quotes' %}" class="back-link">‚Üê Back to Quotes</a>
    <h1>Quote Request #{{ quote.id }}</h1>
</div>

<div class="quote-details">
    <table class="quote-table">
        <tr>
            <th>Manager:</th>
            <td>{{ quote.manager }}</td>
        </tr>
        <tr>
            <th>Client:</th>
            <td>{{ quote.client }}</td>
        </tr>
        <tr>
            <th>Machine Type:</th>
            <td>{{ quote.get_machine_type_display }}</td>
        </tr>
        
        {% if quote.machine_type == 'laser_cutting' %}
            <tr>
                <th>Working Area:</th>
                <td>{{ quote.working_area|default:"-" }}</td>
            </tr>
            <tr>
                <th>Laser Source Power:</th>
                <td>{{ quote.laser_source_power|default:"-" }}</td>
            </tr>
            <tr>
                <th>Compressor:</th>
                <td>{{ quote.compressor|yesno:"Yes,No,-" }}</td>
            </tr>
            <tr>
                <th>Stabilizer:</th>
                <td>{{ quote.stabilizer|yesno:"Yes,No,-" }}</td>
            </tr>
            <tr>
                <th>Bevel Laser Head:</th>
                <td>{{ quote.bevel_laser_head|yesno:"Yes,No,-" }}</td>
            </tr>

        {% elif quote.machine_type == 'press_brake' %}
            <tr>
                <th>Bending Capacity:</th>
                <td>{{ quote.bending_capacity|default:"-" }}</td>
            </tr>
            <tr>
                <th>Working Length:</th>
                <td>{{ quote.working_length|default:"-" }}</td>
            </tr>
            <tr>
                <th>CNC Type:</th>
                <td>{{ quote.get_CNC_type_display|default:"-" }}</td>
            </tr>
            <tr>
                <th>Axis Type:</th>
                <td>{{ quote.get_axis_type_display|default:"-" }}</td>
            </tr>

        {% elif quote.machine_type == 'tube_laser' %}
            <tr>
                <th>Tube Length:</th>
                <td>{{ quote.tube_length|default:"-" }}</td>
            </tr>
            <tr>
                <th>Tube Diameter:</th>
                <td>{{ quote.tube_diameter|default:"-" }}</td>
            </tr>
            <tr>
                <th>Length of Unloading Table:</th>
                <td>{{ quote.length_of_unloading_table|default:"-" }}</td>
            </tr>
            <tr>
                <th>Automatic Loading:</th>
                <td>{{ quote.automatic_loading|yesno:"Yes,No,-" }}</td>
            </tr>
            <tr>
                <th>Semi-Automatic Loading:</th>
                <td>{{ quote.semi_automatic_loading|yesno:"Yes,No,-" }}</td>
            </tr>
            <tr>
                <th>Manual Loading:</th>
                <td>{{ quote.manual_loading|yesno:"Yes,No,-" }}</td>
            </tr>
        {% endif %}

        {% if quote.additional_requirements %}
            <tr class="additional-requirements">
                <th>Additional Requirements:</th>
                <td>{{ quote.additional_requirements }}</td>
            </tr>
        {% endif %}
        <tr>
            <th>Request text:</th>
            <td>{% if quote.request_text %}{{ quote.request_text }}{% else %}Please send a quotation for {{ quote.get_machine_type_display }}{% endif %}</td>
        </tr>
        
        {% if quote.attachment %}
        <tr>
            <th>Attachment:</th>
            <td>
                {% if quote.attachment and quote.attachment.url %}
                    <a href="{{ quote.attachment.url }}" target="_blank" class="attachment-link">
                        <i class="fas fa-paperclip"></i>
                        {{ quote.attachment.name|slice:":30" }}{% if quote.attachment.name|length > 30 %}...{% endif %}
                    </a>
                {% else %}
                    <span class="text-muted">No file attached or file not found</span>
                {% endif %}
            </td>
        </tr>
        {% endif %}

    </table>

    <div class="timestamp">
        <span class="timestamp-label">Created:</span>
        <span class="timestamp-value">{{ quote.created_at|date:"d M Y, H:i" }}</span>
    </div>

</div>

<style>
.quote-details {
    margin: 20px 0;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    overflow: hidden;
}

.quote-table {
    width: 100%;
    border-collapse: collapse;
}

.quote-table th, 
.quote-table td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid #eaeaea;
}

.quote-table th {
    width: 25%;
    font-weight: 500;
    color: #555;
    background-color: #f9f9f9;
}

.quote-table tr:last-child td {
    border-bottom: none;
}

.quote-table tr:hover {
    background-color: #f5f5f5;
}

.additional-requirements td {
    white-space: pre-wrap;
    word-wrap: break-word;
}

.attachment-link {
    display: inline-flex;
    align-items: center;
    color: #2563eb;
    text-decoration: none;
    padding: 6px 12px;
    border: 1px solid #e2e8f0;
    border-radius: 4px;
    background-color: #f8fafc;
    transition: all 0.2s;
}

.attachment-link:hover {
    background-color: #f1f5f9;
    border-color: #cbd5e1;
}

.attachment-link i {
    margin-right: 8px;
    color: #64748b;
}

.timestamp {
    margin-top: 20px;
    padding: 10px;
    background-color: #f8f9fa;
    border-radius: 4px;
    font-size: 0.9em;
    color: #6c757d;
}

.timestamp-label {
    font-weight: 500;
    margin-right: 8px;
}

.timestamp-value {
    font-family: monospace;
}

/* Responsive table */
@media (max-width: 768px) {
    .quote-table {
        display: block;
        overflow-x: auto;
    }
    
    .quote-table th,
    .quote-table td {
        padding: 10px 12px;
    }
    
    .quote-table th {
        width: 50%;
    }
}
</style>

{% endblock %}