{% extends 'base/main.html' %}
{% load util_tags %}

{% block content %}
<style>
    .quote-detail-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 25px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .header-section {
        border-bottom: 3px solid #007bff;
        padding-bottom: 10px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .header-section h2 {
        color: #333;
        margin: 0;
    }
    .actions a {
        padding: 8px 15px;
        margin-left: 10px;
        border-radius: 4px;
        text-decoration: none;
        font-weight: bold;
        transition: background-color 0.3s;
    }
    .actions .edit-btn {
        background-color: #ffc107;
        color: #333;
    }
    .actions .delete-btn {
        background-color: #dc3545;
        color: white;
    }
    .status-badge {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 4px;
        font-weight: bold;
        margin-left: 10px;
    }
    .status-completed {
        background-color: #28a745;
        color: white;
    }
    .status-pending {
        background-color: #ffc107;
        color: #333;
    }
    .data-group {
        margin-bottom: 20px;
        padding: 15px;
        border: 1px solid #e9ecef;
        border-radius: 6px;
    }
    .data-group h4 {
        color: #007bff;
        margin-top: 0;
        padding-bottom: 5px;
        border-bottom: 1px solid #007bff;
        margin-bottom: 15px;
    }
    .data-item {
        margin-bottom: 10px;
        line-height: 1.5;
    }
    .data-item strong {
        display: inline-block;
        min-width: 150px;
        color: #555;
    }
    .additional-req {
        white-space: pre-wrap;
    }
</style>

<div class="quote-detail-container">
    <div class="header-section">
        <h2>{{ quote.title|default:"Quote Details" }}</h2>
        <div class="actions">
            <a href="{% url 'quote-update' quote.id %}" class="edit-btn">
                <i class="fas fa-edit"></i> Edit
            </a>
            <a href="{% url 'quote-delete' quote.id %}" class="delete-btn">
                <i class="fas fa-trash-alt"></i> Delete
            </a>
        </div>
    </div>

    {# --- 1. Core Quote Information --- #}
    <div class="data-group">
        <h4>General Information</h4>
        <div class="data-item">
            <strong>ID:</strong> {{ quote.id }}
        </div>
        <div class="data-item">
            <strong>Status:</strong> 
            <span class="status-badge {% if quote.completed %}status-completed{% else %}status-pending{% endif %}">
                {{ quote.get_completed_display|default:quote.completed|yesno:"Completed,Pending" }}
            </span>
        </div>
        <div class="data-item">
            <strong>Manager:</strong> {{ quote.manager }}
        </div>
        <div class="data-item">
            <strong>Client:</strong> {{ quote.client }}
        </div>
        <div class="data-item">
            <strong>Machine Type:</strong> {{ quote.get_machine_type_display }}
        </div>
        <div class="data-item">
            <strong>Created By:</strong> {{ quote.user.username }}
        </div>
        <div class="data-item">
            <strong>Date:</strong> {{ quote.created_at|date:"d M Y (H:i)" }}
        </div>
    </div>

    {# --- 2. Dynamic Specification Information --- #}
   {% if spec %}
        <div class="data-group">
            <h4>Specifications for {{ quote.get_machine_type_display }}</h4>
            
            {# Loop through the list of field objects provided by the view #}
            {% for field in spec_fields %} 
                <div class="data-item">
                    <strong>{{ field.verbose_name|capfirst }}:</strong> 
                    
                    {# Use field.name to access the value on the 'spec' object #}
                    {% with value=spec|get_attribute:field.name %}
                        
                        {% if field.get_internal_type == 'BooleanField' %}
                            {{ value|yesno:"Yes,No" }}
                        {% elif field.choices %}
                            {# Requires the spec object and field name to resolve choices #}
                            {{ spec|get_attribute_display:field.name }}
                        {% else %}
                            {{ value|default:"N/A" }}
                        {% endif %}
                    {% endwith %}
                </div>
            {% endfor %}
            
        </div>
    {% endif %}

    {# --- 3. Additional Requirements and Attachment --- #}
    <div class="data-group">
        <h4>Additional Details</h4>
        <div class="data-item">
            <strong>Attachment:</strong> 
            {% if quote.attachment %}
                <a href="{{ quote.attachment.url }}" target="_blank">View Attached File ({{ quote.attachment.name|default:"File" }})</a>
            {% else %}
                No file attached.
            {% endif %}
        </div>
        <div class="data-item">
            <strong>Requirements:</strong> 
            <span class="additional-req">{{ quote.additional_requirements|default:"None provided." }}</span>
        </div>
    </div>
</div>

{% endblock %}